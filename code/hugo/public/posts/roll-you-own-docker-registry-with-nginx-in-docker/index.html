<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Roll you own Docker Registry with nginx (In Docker) | Life and Shell</title>
  <link rel = 'canonical' href = 'https://lifeandshell.com/posts/roll-you-own-docker-registry-with-nginx-in-docker/'>
  <meta name="description" content="  Mattias Hemmingsson: Welcome to my private site collecting blog post, Git updates and podcast episodes">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">



 <script async src="https://www.googletagmanager.com/gtag/js?id=G-3SYH00HY9X"></script>
 <script>
   window.dataLayer = window.dataLayer || [];
   function gtag(){dataLayer.push(arguments);}
   gtag('js', new Date());
   gtag('config', 'G-3SYH00HY9X');
 </script>


  <meta property="og:url" content="https://lifeandshell.com/posts/roll-you-own-docker-registry-with-nginx-in-docker/">
  <meta property="og:site_name" content="Life and Shell">
  <meta property="og:title" content="Roll you own Docker Registry with nginx (In Docker)">
  <meta property="og:description" content="When yor private numbers of docker images grow is time to setup you own private repo.
Do have you own docker repo you need 1. the docker registry 2. nginx to handel users 3. tls so that all conenctions are encrypted.
So here is what yu do to have you own docker repo running.
 
 
Install docker-compsoe and setup the followin docker-compose file storage: image: busybox volumes: - /backup/docker/registry:/var/lib/docker/registry cache: image: redis registry: image: registry ports: - 127.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2016-03-19T23:25:36+00:00">
    <meta property="article:modified_time" content="2016-03-19T23:25:36+00:00">
    <meta property="article:tag" content="Docker">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Roll you own Docker Registry with nginx (In Docker)">
  <meta name="twitter:description" content="When yor private numbers of docker images grow is time to setup you own private repo.
Do have you own docker repo you need 1. the docker registry 2. nginx to handel users 3. tls so that all conenctions are encrypted.
So here is what yu do to have you own docker repo running.
 
 
Install docker-compsoe and setup the followin docker-compose file storage: image: busybox volumes: - /backup/docker/registry:/var/lib/docker/registry cache: image: redis registry: image: registry ports: - 127.">

  
  
    
  
  
  <link rel="stylesheet" href="https://lifeandshell.com/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css" integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N&#43;XoIuZg=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://lifeandshell.com/images/favicon.ico" />

  
  
  

</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts/">Writings</a></li>
         
        <li><a href="/tags/">Tags</a></li>
         
        <li><a href="/git/">Git</a></li>
         
        <li><a href="/podcast/">Podcast</a></li>
         
        <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://lifeandshell.com/posts/maxscale-sql-scaling-with-mariadb-cluster-in-docker/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://lifeandshell.com/posts/wordpress-multisite-wordpress-singelsite-easy-linux/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f&text=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f&title=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f&is_video=false&description=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29&body=Check out this article: https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f&title=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f&title=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f&name=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29&description=When%20yor%20private%20numbers%20of%20docker%20images%20grow%20is%20time%20to%20setup%20you%20own%20private%20repo.%0aDo%20have%20you%20own%20docker%20repo%20you%20need%201.%20the%20docker%20registry%202.%20nginx%20to%20handel%20users%203.%20tls%20so%20that%20all%20conenctions%20are%20encrypted.%0aSo%20here%20is%20what%20yu%20do%20to%20have%20you%20own%20docker%20repo%20running.%0a%26nbsp%3b%0a%26nbsp%3b%0aInstall%20docker-compsoe%20and%20setup%20the%20followin%20docker-compose%20file%20storage%3a%20image%3a%20busybox%20volumes%3a%20-%20%2fbackup%2fdocker%2fregistry%3a%2fvar%2flib%2fdocker%2fregistry%20cache%3a%20image%3a%20redis%20registry%3a%20image%3a%20registry%20ports%3a%20-%20127." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f&t=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Roll you own Docker Registry with nginx (In Docker)
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2016-03-19 23:25:36 &#43;0000 UTC" itemprop="datePublished">2016-03-19</time>
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          2 minute read
        </div>
        
        
        <div class="article-category">
            <i class="fas fa-archive"></i>
            
            
            <a class="category-link" href="/categories/docker">docker</a>
            
        </div>
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/docker" rel="tag">docker</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <p>When yor private numbers of docker images grow is time to setup you own private repo.<br />
Do have you own docker repo you need 1. the docker registry 2. nginx to handel users 3. tls so that all conenctions are encrypted.</p>
<p>So here is what yu do to have you own docker repo running.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<ol>
<li>Install docker-compsoe and setup the followin docker-compose file</li>
</ol>
<pre>storage: 
 image: busybox 
 volumes: 
 - /backup/docker/registry:/var/lib/docker/registry 
cache: 
 image: redis 
registry: 
 image: registry 
 ports: 
 - 127.0.0.1:5000:5000 
 links: 
 - cache 
 - storage 
 volumes_from: 
 - storage
 environment: 
 STANDALONE: true
 SETTINGS_FLAVOR: local 
 STORAGE_PATH: /var/lib/docker/registry 
 SEARCH_BACKEND: sqlalchemy 
 CACHE_REDIS_HOST: cache 
 CACHE_REDIS_PORT: 6379 
 CACHE_LRU_REDIS_HOST: cache 
 CACHE_LRU_REDIS_PORT: 6379
webb:
 #image: mattiashem/nginx-registry
 build: registry-front/
 ports:
 - 443:443
 - 80:80
 links:
 - registry</pre>
<p>&nbsp;</p>
<p>create the folder registry-front in that folder we are going to add our users and our certs for the tls.<br />
So create a Dockerfile and add the following</p>
<p>&nbsp;</p>
<pre>#Base docker file for lifeandshell.com
FROM mattiashem/nginx-registry
MAINTAINER "Mattias Hemmingsson" &lt;matte.hemmingsson@gmail.com&gt;

EXPOSE 80
EXPOSE 443

ADD nginx.htpasswd /etc/nginx/nginx.htpasswd
ADD cert.pem /etc/nginx/ssl/nginx.crt
ADD privkey.pem /etc/nginx/ssl/nginx.key
ADD fullchain.pem /etc/nginx/ssl/fullchain.pem

CMD nginx -g "daemon off;"</pre>
<p>The file I get from using letsencrypt that are free but you can  get from any source. Chnage so that the source files are mathcing with you certs.</p>
<p>&nbsp;</p>
<p>Now time for setting up some users create the file add_user.sh and add the followin content to it</p>
<p>&nbsp;</p>
<pre>docker run --rm --entrypoint htpasswd registry:2 -bn user1 password &gt; nginx.htpasswd
docker run --rm --entrypoint htpasswd registry:2 -bn user2 password &gt;&gt; nginx.htpasswd
docker run --rm --entrypoint htpasswd registry:2 -bn user3 password &gt;&gt; nginx.htpasswd
docker run --rm --entrypoint htpasswd registry:2 -bn user4 password &gt;&gt; nginx.htpasswd</pre>
<p>&nbsp;</p>
<p>make the script x and run intt In the registry-front folder</p>
<pre>chmod +x add_user.sh
./add_user.sh</pre>
<p>&nbsp;</p>
<p>Now we are ready to start our registry do the the base filer with the docker-compose.yml and run</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<pre>docker-compose build</pre>
<pre>docker-compose up</pre>
<p>&nbsp;</p>
<p>And now when everthing is wokring run</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<pre>docker-compose start</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>And now you docker-registry should be up and running</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts/">Writings</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/git/">Git</a></li>
         
          <li><a href="/podcast/">Podcast</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f&text=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f&title=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f&is_video=false&description=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29&body=Check out this article: https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f&title=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f&title=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f&name=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29&description=When%20yor%20private%20numbers%20of%20docker%20images%20grow%20is%20time%20to%20setup%20you%20own%20private%20repo.%0aDo%20have%20you%20own%20docker%20repo%20you%20need%201.%20the%20docker%20registry%202.%20nginx%20to%20handel%20users%203.%20tls%20so%20that%20all%20conenctions%20are%20encrypted.%0aSo%20here%20is%20what%20yu%20do%20to%20have%20you%20own%20docker%20repo%20running.%0a%26nbsp%3b%0a%26nbsp%3b%0aInstall%20docker-compsoe%20and%20setup%20the%20followin%20docker-compose%20file%20storage%3a%20image%3a%20busybox%20volumes%3a%20-%20%2fbackup%2fdocker%2fregistry%3a%2fvar%2flib%2fdocker%2fregistry%20cache%3a%20image%3a%20redis%20registry%3a%20image%3a%20registry%20ports%3a%20-%20127." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2flifeandshell.com%2fposts%2froll-you-own-docker-registry-with-nginx-in-docker%2f&t=Roll%20you%20own%20Docker%20Registry%20with%20nginx%20%28In%20Docker%29" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2026  Mattias Hemmingssion <a href="mailto:mattias@lifeandshell.com">mattias@lifeandshell.com</a> 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts/">Writings</a></li>
         
        <li><a href="/tags/">Tags</a></li>
         
        <li><a href="/git/">Git</a></li>
         
        <li><a href="/podcast/">Podcast</a></li>
         
        <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>

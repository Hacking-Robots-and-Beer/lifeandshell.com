<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Ossec agent auto multi installation | Life and Shell</title>
  <link rel = 'canonical' href = 'https://lifeandshell.com/posts/ossec-agent-auto-multi-installation/'>
  <meta name="description" content="  Mattias Hemmingsson: Welcome to my private site collecting blog post, Git updates and podcast episodes">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">



 <script async src="https://www.googletagmanager.com/gtag/js?id=G-3SYH00HY9X"></script>
 <script>
   window.dataLayer = window.dataLayer || [];
   function gtag(){dataLayer.push(arguments);}
   gtag('js', new Date());
   gtag('config', 'G-3SYH00HY9X');
 </script>


  <meta property="og:url" content="https://lifeandshell.com/posts/ossec-agent-auto-multi-installation/">
  <meta property="og:site_name" content="Life and Shell">
  <meta property="og:title" content="Ossec agent auto multi installation">
  <meta property="og:description" content="Ossec är det övervakninsg system som jag använder mest.
En sak som dock ställer till det lite att man hela tiden måste para ihop agneten med server.
Det fungerar kalas om man bara har några få servrar. Men har man en massa blir det lite mekigare.
Men nu så kan man scripta upp så man kan installera agenter automatist.
Börja med att skapa nycklarna på ossec server
Det första vi ska göra är att skapa upp nycklarna på ossec server.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2012-09-06T09:31:32+00:00">
    <meta property="article:modified_time" content="2012-09-06T09:31:32+00:00">
    <meta property="article:tag" content="Security">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Ossec agent auto multi installation">
  <meta name="twitter:description" content="Ossec är det övervakninsg system som jag använder mest.
En sak som dock ställer till det lite att man hela tiden måste para ihop agneten med server.
Det fungerar kalas om man bara har några få servrar. Men har man en massa blir det lite mekigare.
Men nu så kan man scripta upp så man kan installera agenter automatist.
Börja med att skapa nycklarna på ossec server
Det första vi ska göra är att skapa upp nycklarna på ossec server.">

  
  
    
  
  
  <link rel="stylesheet" href="https://lifeandshell.com/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css" integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N&#43;XoIuZg=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://lifeandshell.com/images/favicon.ico" />

  
  
  

</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts/">Writings</a></li>
         
        <li><a href="/tags/">Tags</a></li>
         
        <li><a href="/git/">Git</a></li>
         
        <li><a href="/podcast/">Podcast</a></li>
         
        <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://lifeandshell.com/posts/fa-ossec-att-logga-sina-loggar-till-syslog/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://lifeandshell.com/posts/ubuntu-tftp-server/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f&text=Ossec%20agent%20auto%20multi%20installation" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f&title=Ossec%20agent%20auto%20multi%20installation" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f&is_video=false&description=Ossec%20agent%20auto%20multi%20installation" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Ossec%20agent%20auto%20multi%20installation&body=Check out this article: https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f&title=Ossec%20agent%20auto%20multi%20installation" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f&title=Ossec%20agent%20auto%20multi%20installation" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f&name=Ossec%20agent%20auto%20multi%20installation&description=Ossec%20%c3%a4r%20det%20%c3%b6vervakninsg%20system%20som%20jag%20anv%c3%a4nder%20mest.%0aEn%20sak%20som%20dock%20st%c3%a4ller%20till%20det%20lite%20att%20man%20hela%20tiden%20m%c3%a5ste%20para%20ihop%20agneten%20med%20server.%0aDet%20fungerar%20kalas%20om%20man%20bara%20har%20n%c3%a5gra%20f%c3%a5%20servrar.%20Men%20har%20man%20en%20massa%20blir%20det%20lite%20mekigare.%0aMen%20nu%20s%c3%a5%20kan%20man%20scripta%20upp%20s%c3%a5%20man%20kan%20installera%20agenter%20automatist.%0aB%c3%b6rja%20med%20att%20skapa%20nycklarna%20p%c3%a5%20ossec%20server%0aDet%20f%c3%b6rsta%20vi%20ska%20g%c3%b6ra%20%c3%a4r%20att%20skapa%20upp%20nycklarna%20p%c3%a5%20ossec%20server." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f&t=Ossec%20agent%20auto%20multi%20installation" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Ossec agent auto multi installation
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2012-09-06 09:31:32 &#43;0000 UTC" itemprop="datePublished">2012-09-06</time>
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          2 minute read
        </div>
        
        
        <div class="article-category">
            <i class="fas fa-archive"></i>
            
            
            <a class="category-link" href="/categories/security">Security</a>
            
        </div>
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/security" rel="tag">Security</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <p>Ossec är det övervakninsg system som jag använder mest.<br />
En sak som dock ställer till det lite att man hela tiden måste para ihop agneten med server.<br />
Det fungerar kalas om man bara har några få servrar. Men har man en massa blir det lite mekigare.<br />
Men nu så kan man scripta upp så man kan installera agenter automatist.</p>
<p><b>Börja med att skapa nycklarna på ossec server</b><br />
Det första vi ska göra är att skapa upp nycklarna på ossec server.<br />
Här kan man använda en ny funktion i ossec som heter bash.<br />
Jag visar nu bara hur man gör så kan du sen själv scripta upp så den skapar upp nycklar till alla dina servrar</p>
<p>Batchmanager finns i packfilen som du laddar hem från ossec.<br />
Så den finns INTE i ossec som är installerad på server.<br />
Kolla i ossec installations katalogen och under &#8220;contrib&#8221;</p>
<p>Centos 6<br />
Installera följande paket för att bath ska fungera</p>
<pre>
yum install perl-Time-HiRes
</pre>
<p>Och för att kunna bygga ossec måste gcc och make finnas.</p>
<pre>
yum install gcc make
</pre>
<p>Skapa nyckeln</p>
<pre>
./ossec-batch-manager.pl -a -n clinet.fareonline.net -p 192.168.122.158
</pre>
<p>Nu kan du kolla i filen /var/ossec/clinet.keys där ska nu den nya nyckeln finnas</p>
<pre>
grep clinet.fareonline.net /var/ossec/etc/client.keys
</pre>
<p><b>Sätta upp agent configurationen</b><br />
Nu ska vi konfa vilka installningar ageneten ska ha när den installeras.<br />
I ossec installations katalogen leta fram filen preload-vars.conf och öppna den.</p>
<p>Ställ där in de saker som du vill att din klinet ska göra.<br />
Tex installera med engelska och ossec server ip.<br />
Samnt vilka säkerhets tjänster du vill aktivera.<br />
Glöm inte att även ställa in att den inte ska visa några frågor vid installationen.</p>
<p>Ta sedan och kopiera över hela din ossec installations katalog till klineten.<br />
Jag kommer att lägga in den i min git.<br />
Sedan så kan jag enkelt scripta att så den uppdaterar min git och kör igång installtionen.<br />
Men det fungerar även kalas att dra över den med tex scp.<br />
Du kan sedan scripta in det som passar bäst.</p>
<p>med scp till min klinet</p>
<pre>
scp -r ossec-hids-2.6/ root@192.168.122.158:/opt
</pre>
<p>Sedan är det daxs att köra igång installationen på clienten med /install.sh<br />
Om nu allt går bra ska du inte få några frågor utan instalaltionen ska bara rull igenom.</p>
<p>Nu ska vi kopiera över nycklarna som vi har på ossec server.<br />
Följande kommando tar ut rätt nyckeln och lägge den i en fil.</p>
<pre>
grep clinet.fareonline.net /var/ossec/etc/client.keys > /tmp/clinet.fareonline.net
</pre>
<p>Sedan kopierar vi över den till ossec klienten</p>
<pre>
scp /tmp/clinet.fareonline.net root@192.168.122.158:/var/ossec/etc/client.keys
</pre>
<p>Sedan måste vi sätta rätt rättigheter på clinet.keys filen</p>
<pre>
chown root:ossec /var/ossec/etc/client.keys
</pre>
<p>Nu ska det bara vara att starta om ossec server och agneten och det ska fungera.</p>
<p>Jag har dock haft lite problem med att iblen få agneten att ansluta till server och för att felsöka brukar jag köra.</p>
<p>på server för att få info om agneten skcikar rätt och om ossec-remoted fungerar</p>
<pre>
ps aux | grep ossec-remote
netstat -anp | grep 1514
tcpdump port 1514
./ossec-remotd -f
</pre>
<p>Sedan brukar jag starta om klienten och se vad som händer.</p>
<p>The post is brought to you by <a href="http://fedorahosted.org/lekhonee">lekhonee</a> v0.7</p>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts/">Writings</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/git/">Git</a></li>
         
          <li><a href="/podcast/">Podcast</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f&text=Ossec%20agent%20auto%20multi%20installation" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f&title=Ossec%20agent%20auto%20multi%20installation" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f&is_video=false&description=Ossec%20agent%20auto%20multi%20installation" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Ossec%20agent%20auto%20multi%20installation&body=Check out this article: https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f&title=Ossec%20agent%20auto%20multi%20installation" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f&title=Ossec%20agent%20auto%20multi%20installation" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f&name=Ossec%20agent%20auto%20multi%20installation&description=Ossec%20%c3%a4r%20det%20%c3%b6vervakninsg%20system%20som%20jag%20anv%c3%a4nder%20mest.%0aEn%20sak%20som%20dock%20st%c3%a4ller%20till%20det%20lite%20att%20man%20hela%20tiden%20m%c3%a5ste%20para%20ihop%20agneten%20med%20server.%0aDet%20fungerar%20kalas%20om%20man%20bara%20har%20n%c3%a5gra%20f%c3%a5%20servrar.%20Men%20har%20man%20en%20massa%20blir%20det%20lite%20mekigare.%0aMen%20nu%20s%c3%a5%20kan%20man%20scripta%20upp%20s%c3%a5%20man%20kan%20installera%20agenter%20automatist.%0aB%c3%b6rja%20med%20att%20skapa%20nycklarna%20p%c3%a5%20ossec%20server%0aDet%20f%c3%b6rsta%20vi%20ska%20g%c3%b6ra%20%c3%a4r%20att%20skapa%20upp%20nycklarna%20p%c3%a5%20ossec%20server." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2flifeandshell.com%2fposts%2fossec-agent-auto-multi-installation%2f&t=Ossec%20agent%20auto%20multi%20installation" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2026  Mattias Hemmingssion <a href="mailto:mattias@lifeandshell.com">mattias@lifeandshell.com</a> 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts/">Writings</a></li>
         
        <li><a href="/tags/">Tags</a></li>
         
        <li><a href="/git/">Git</a></li>
         
        <li><a href="/podcast/">Podcast</a></li>
         
        <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>

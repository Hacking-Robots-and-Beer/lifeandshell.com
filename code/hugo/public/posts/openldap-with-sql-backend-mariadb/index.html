<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Openldap with SQL Backend (Mariadb Centos 7 ) in Docker | Life and Shell</title>
  <link rel = 'canonical' href = 'https://lifeandshell.com/posts/openldap-with-sql-backend-mariadb/'>
  <meta name="description" content="  Mattias Hemmingsson: Welcome to my private site collecting blog post, Git updates and podcast episodes">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">



 <script async src="https://www.googletagmanager.com/gtag/js?id=G-3SYH00HY9X"></script>
 <script>
   window.dataLayer = window.dataLayer || [];
   function gtag(){dataLayer.push(arguments);}
   gtag('js', new Date());
   gtag('config', 'G-3SYH00HY9X');
 </script>


  <meta property="og:url" content="https://lifeandshell.com/posts/openldap-with-sql-backend-mariadb/">
  <meta property="og:site_name" content="Life and Shell">
  <meta property="og:title" content="Openldap with SQL Backend (Mariadb Centos 7 ) in Docker">
  <meta property="og:description" content="We use Ldap for handling our users and I have spent time setting up Openldap and tryng to configur it.
But now i have given up my ldap skills and setup my openldap to use a sql backend and then i config my user with SQL that i like more.
I have also build i Dockerfile for docker that you can use.
 
 
So what you need is one sql databserver to hold that database, One odbc connection from the ldap server to that sql server.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2016-01-21T15:59:14+00:00">
    <meta property="article:modified_time" content="2016-01-21T15:59:14+00:00">
    <meta property="article:tag" content="Docker">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Web">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Openldap with SQL Backend (Mariadb Centos 7 ) in Docker">
  <meta name="twitter:description" content="We use Ldap for handling our users and I have spent time setting up Openldap and tryng to configur it.
But now i have given up my ldap skills and setup my openldap to use a sql backend and then i config my user with SQL that i like more.
I have also build i Dockerfile for docker that you can use.
 
 
So what you need is one sql databserver to hold that database, One odbc connection from the ldap server to that sql server.">

  
  
    
  
  
  <link rel="stylesheet" href="https://lifeandshell.com/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css" integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N&#43;XoIuZg=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://lifeandshell.com/images/favicon.ico" />

  
  
  

</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts/">Writings</a></li>
         
        <li><a href="/tags/">Tags</a></li>
         
        <li><a href="/git/">Git</a></li>
         
        <li><a href="/podcast/">Podcast</a></li>
         
        <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://lifeandshell.com/posts/mesos-cluster-with-marathon-running-docker/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://lifeandshell.com/posts/mariadb-cluster-with-dynamic-nodes-in-docker/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f&text=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f&title=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f&is_video=false&description=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker&body=Check out this article: https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f&title=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f&title=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f&name=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker&description=We%20use%20Ldap%20for%20handling%20our%20users%20and%20I%20have%20spent%20time%20setting%20up%20Openldap%20and%20tryng%20to%20configur%20it.%0aBut%20now%20i%20have%20given%20up%20my%20ldap%20skills%20and%20setup%20my%20openldap%20to%20use%20a%20sql%20backend%20and%20then%20i%20config%20my%20user%20with%20SQL%20that%20i%20like%20more.%0aI%20have%20also%20build%20i%20Dockerfile%20for%20docker%20that%20you%20can%20use.%0a%26nbsp%3b%0a%26nbsp%3b%0aSo%20what%20you%20need%20is%20one%20sql%20databserver%20to%20hold%20that%20database%2c%20One%20odbc%20connection%20from%20the%20ldap%20server%20to%20that%20sql%20server." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f&t=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Openldap with SQL Backend (Mariadb Centos 7 ) in Docker
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2016-01-21 15:59:14 &#43;0000 UTC" itemprop="datePublished">2016-01-21</time>
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          6 minute read
        </div>
        
        
        <div class="article-category">
            <i class="fas fa-archive"></i>
            
            
            <a class="category-link" href="/categories/docker">docker</a>
            
             ,  
            <a class="category-link" href="/categories/linux">Linux</a>
            
             ,  
            <a class="category-link" href="/categories/web">Web</a>
            
        </div>
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/docker" rel="tag">docker</a>
            
             ,  
            <a class="tag-link" href="/tags/linux" rel="tag">Linux</a>
            
             ,  
            <a class="tag-link" href="/tags/web" rel="tag">Web</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <p>We use Ldap for handling our users and I have spent time setting up Openldap and tryng to configur it.</p>
<p>But now i have given up my ldap skills and setup my openldap to use a sql backend and then i config my user with SQL that i like more.<br />
I have also build i Dockerfile for docker that you can use.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>So what you need is one sql databserver to hold that database, One odbc connection from the ldap server to that sql server. And then to configure Opendal to use that odbc to get users.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>1. Setup the mysql</h3>
<p>&nbsp;</p>
<pre>yum install mariadb-server -y</pre>
<p>&nbsp;</p>
<p>Load that database with this data</p>
<p>&nbsp;</p>
<p>mysql &lt; init-sql.sql</p>
<p>&nbsp;</p>
<p>init-sql.sql</p>
<p>&nbsp;</p>
<p>create database ldap;</p>
<pre>CREATE USER 'ldap'@'%' IDENTIFIED BY 'ldap';
GRANT ALL PRIVILEGES ON ldap.* TO 'ldap'@'%';
CREATE USER 'ldap'@'localhost' IDENTIFIED BY 'ldap';
GRANT ALL PRIVILEGES ON ldap.* TO 'ldap'@'localhost';
use ldap;

drop table if exists ldap_oc_mappings;
create table ldap_oc_mappings
 (
 id integer unsigned not null primary key auto_increment,
 name varchar(64) not null,
 keytbl varchar(64) not null,
 keycol varchar(64) not null,
 create_proc varchar(255),
 delete_proc varchar(255),
 expect_return tinyint not null
);

drop table if exists ldap_attr_mappings;
create table ldap_attr_mappings
 (
 id integer unsigned not null primary key auto_increment,
 oc_map_id integer unsigned not null references ldap_oc_mappings(id),
 name varchar(255) not null,
 sel_expr varchar(255) not null,
 sel_expr_u varchar(255),
 from_tbls varchar(255) not null,
 join_where varchar(255),
 add_proc varchar(255),
 delete_proc varchar(255),
 param_order tinyint not null,
 expect_return tinyint not null
);

drop table if exists ldap_entries;
create table ldap_entries
 (
 id integer unsigned not null primary key auto_increment,
 dn varchar(255) not null,
 oc_map_id integer unsigned not null references ldap_oc_mappings(id),
 parent int NOT NULL ,
 keyval int NOT NULL 
);

alter table ldap_entries add 
 constraint unq1_ldap_entries unique
 (
 oc_map_id,
 keyval
 );
alter table ldap_entries add
 constraint unq2_ldap_entries unique
 (
 dn
 );

drop table if exists ldap_entry_objclasses;
create table ldap_entry_objclasses
 (
 entry_id integer not null references ldap_entries(id),
 oc_name varchar(64)
 );
drop table if exists persons;
CREATE TABLE persons (
 id int NOT NULL,
 name varchar(255) NOT NULL,
 surname varchar(255) NOT NULL,
 password varchar(64)
);

drop table if exists institutes;
CREATE TABLE institutes (
 id int NOT NULL,
 name varchar(255)
);

drop table if exists documents;
CREATE TABLE documents (
 id int NOT NULL,
 title varchar(255) NOT NULL,
 abstract varchar(255)
);

drop table if exists authors_docs;
CREATE TABLE authors_docs (
 pers_id int NOT NULL,
 doc_id int NOT NULL
);

drop table if exists phones;
CREATE TABLE phones (
 id int NOT NULL ,
 phone varchar(255) NOT NULL ,
 pers_id int NOT NULL 
);

drop table if exists certs;
CREATE TABLE certs (
 id int NOT NULL ,
 cert LONGBLOB NOT NULL,
 pers_id int NOT NULL 
);

drop table if exists referrals;
CREATE TABLE referrals (
 id int NOT NULL,
 name varchar(255) NOT NULL,
 url varchar(255) NOT NULL
);
insert into institutes (id,name) values (1,'life');
insert into persons (id,name,surname,password) values (1,'Mitya','Kovalev','mit');
insert into persons (id,name,surname) values (2,'Torvlobnor','Puzdoy');
insert into persons (id,name,surname) values (3,'Akakiy','Zinberstein');
insert into phones (id,phone,pers_id) values (1,'332-2334',1);
insert into phones (id,phone,pers_id) values (2,'222-3234',1);
insert into phones (id,phone,pers_id) values (3,'545-4563',2);
insert into documents (id,abstract,title) values (1,'abstract1','book1');
insert into documents (id,abstract,title) values (2,'abstract2','book2');

insert into authors_docs (pers_id,doc_id) values (1,1);
insert into authors_docs (pers_id,doc_id) values (1,2);
insert into authors_docs (pers_id,doc_id) values (2,1);
insert into referrals (id,name,url) values (1,'Referral','ldap://localhost:9012/');
insert into certs (id,cert,pers_id) values (1,UNHEX('3082036b308202d4a003020102020102300d06092a864886f70d01010405003077310b3009060355040613025553311330110603550408130a43616c69666f726e6961311f301d060355040a13164f70656e4c444150204578616d706c652c204c74642e311330110603550403130a4578616d706c65204341311d301b06092a864886f70d010901160e6361406578616d706c652e636f6d301e170d3033313031373136333331395a170d3034313031363136333331395a307e310b3009060355040613025553311330110603550408130a43616c69666f726e6961311f301d060355040a13164f70656e4c444150204578616d706c652c204c74642e311830160603550403130f557273756c612048616d7073746572311f301d06092a864886f70d01090116107568616d406578616d706c652e636f6d30819f300d06092a864886f70d010101050003818d0030818902818100eec60a7910b57d2e687158ca55eea738d36f10413dfecf31435e1aeeb9713b8e2da7dd2dde6bc6cec03b4987eaa7b037b9eb50e11c71e58088cc282883122cd8329c6f24f6045e6be9d21b9190c8292998267a5f7905292de936262747ab4b76a88a63872c41629a69d32e894d44c896a8d06fab0a1bc7de343c6c1458478f290203010001a381ff3081fc30090603551d1304023000302c06096086480186f842010d041f161d4f70656e53534c2047656e657261746564204365727469666963617465301d0603551d0e04160414a323de136c19ae0c479450e882dfb10ad147f45e3081a10603551d2304819930819680144b6f211a3624d290f943b053472d7de1c0e69823a17ba4793077310b3009060355040613025553311330110603550408130a43616c69666f726e6961311f301d060355040a13164f70656e4c444150204578616d706c652c204c74642e311330110603550403130a4578616d706c65204341311d301b06092a864886f70d010901160e6361406578616d706c652e636f6d820100300d06092a864886f70d010104050003818100881470045bdce95660d6e6af59e6a844aec4b9f5eaea88d4eb7a5a47080afa64750f81a3e47d00fd39c69a17a1c66d29d36f06edc537107f8c592239c2d4da55fb3f1d488e7b2387ad2a551cbd1ceb070ae9e020a9467275cb28798abb4cbfff98ddb3f1e7689b067072392511bb08125b5bec2bc207b7b6b275c47248f29acd'),3);
insert into ldap_oc_mappings (id,name,keytbl,keycol,create_proc,delete_proc,expect_return)
values (1,'inetOrgPerson','persons','id',NULL,NULL,0);
insert into ldap_oc_mappings (id,name,keytbl,keycol,create_proc,delete_proc,expect_return)
values (2,'document','documents','id',NULL,NULL,0);

insert into ldap_oc_mappings (id,name,keytbl,keycol,create_proc,delete_proc,expect_return)
values (3,'organization','institutes','id',NULL,NULL,0);
insert into ldap_oc_mappings (id,name,keytbl,keycol,create_proc,delete_proc,expect_return)
values (4,'referral','referrals','id',NULL,NULL,0);

insert into ldap_attr_mappings (id,oc_map_id,name,sel_expr,from_tbls,join_where,add_proc,delete_proc,param_order,expect_return)
values (2,1,'telephoneNumber','phones.phone','persons,phones',
 'phones.pers_id=persons.id',NULL,NULL,3,0);

insert into ldap_attr_mappings (id,oc_map_id,name,sel_expr,from_tbls,join_where,add_proc,delete_proc,param_order,expect_return)
values (3,1,'givenName','persons.name','persons',NULL,NULL,NULL,3,0);

insert into ldap_attr_mappings (id,oc_map_id,name,sel_expr,from_tbls,join_where,add_proc,delete_proc,param_order,expect_return)
values (4,1,'sn','persons.surname','persons',NULL,NULL,NULL,3,0);

insert into ldap_attr_mappings (id,oc_map_id,name,sel_expr,from_tbls,join_where,add_proc,delete_proc,param_order,expect_return)
values (5,1,'userPassword','persons.password','persons','persons.password IS NOT NULL',NULL,NULL,3,0);

insert into ldap_attr_mappings (id,oc_map_id,name,sel_expr,from_tbls,join_where,add_proc,delete_proc,param_order,expect_return)
values (6,1,'seeAlso','seeAlso.dn','ldap_entries AS seeAlso,documents,authors_docs,persons',
 'seeAlso.keyval=documents.id AND seeAlso.oc_map_id=2 AND authors_docs.doc_id=documents.id AND authors_docs.pers_id=persons.id',
 NULL,NULL,3,0);

insert into ldap_attr_mappings (id,oc_map_id,name,sel_expr,from_tbls,join_where,add_proc,delete_proc,param_order,expect_return)
values (7,2,'description','documents.abstract','documents',NULL,NULL,NULL,3,0);

insert into ldap_attr_mappings (id,oc_map_id,name,sel_expr,from_tbls,join_where,add_proc,delete_proc,param_order,expect_return)
values (8,2,'documentTitle','documents.title','documents',NULL,NULL,NULL,3,0);

insert into ldap_attr_mappings (id,oc_map_id,name,sel_expr,from_tbls,join_where,add_proc,delete_proc,param_order,expect_return)
values (9,2,'documentAuthor','documentAuthor.dn','ldap_entries AS documentAuthor,documents,authors_docs,persons',
 'documentAuthor.keyval=persons.id AND documentAuthor.oc_map_id=1 AND authors_docs.doc_id=documents.id AND authors_docs.pers_id=persons.id',
 NULL,NULL,3,0);

insert into ldap_attr_mappings (id,oc_map_id,name,sel_expr,from_tbls,join_where,add_proc,delete_proc,param_order,expect_return)
values (10,2,'documentIdentifier','concat(''document '',documents.id)','documents',NULL,NULL,NULL,3,0);

insert into ldap_attr_mappings (id,oc_map_id,name,sel_expr,from_tbls,join_where,add_proc,delete_proc,param_order,expect_return)
values (11,3,'o','institutes.name','institutes',NULL,NULL,NULL,3,0);

insert into ldap_attr_mappings (id,oc_map_id,name,sel_expr,from_tbls,join_where,add_proc,delete_proc,param_order,expect_return)
values (12,3,'dc','lower(institutes.name)','institutes,ldap_entries AS dcObject,ldap_entry_objclasses as auxObjectClass',
 'institutes.id=dcObject.keyval AND dcObject.oc_map_id=3 AND dcObject.id=auxObjectClass.entry_id AND auxObjectClass.oc_name=''dcObject''',
 NULL,NULL,3,0);

insert into ldap_attr_mappings (id,oc_map_id,name,sel_expr,from_tbls,join_where,add_proc,delete_proc,param_order,expect_return)
values (13,4,'ou','referrals.name','referrals',NULL,NULL,NULL,3,0);

insert into ldap_attr_mappings (id,oc_map_id,name,sel_expr,from_tbls,join_where,add_proc,delete_proc,param_order,expect_return)
values (14,4,'ref','referrals.url','referrals',NULL,NULL,NULL,3,0);

insert into ldap_attr_mappings (id,oc_map_id,name,sel_expr,from_tbls,join_where,add_proc,delete_proc,param_order,expect_return)
values (15,1,'userCertificate','certs.cert','persons,certs',
 'certs.pers_id=persons.id',NULL,NULL,3,0);

insert into ldap_entries (id,dn,oc_map_id,parent,keyval)
values (1,'dc=life,dc=com',3,0,1);

insert into ldap_entries (id,dn,oc_map_id,parent,keyval)
values (2,'cn=Mitya Kovalev,dc=life,dc=com',1,1,1);

insert into ldap_entries (id,dn,oc_map_id,parent,keyval)
values (3,'cn=Torvlobnor Puzdoy,dc=life,dc=com',1,1,2);

insert into ldap_entries (id,dn,oc_map_id,parent,keyval)
values (4,'cn=Akakiy Zinberstein,dc=life,dc=com',1,1,3);

insert into ldap_entries (id,dn,oc_map_id,parent,keyval)
values (5,'documentTitle=book1,dc=life,dc=com',2,1,1);

insert into ldap_entries (id,dn,oc_map_id,parent,keyval)
values (6,'documentTitle=book2,dc=life,dc=com',2,1,2);

insert into ldap_entries (id,dn,oc_map_id,parent,keyval)
values (7,'ou=Referral,dc=life,dc=com',4,1,1);

-- objectClass mapping: entries that have multiple objectClass instances are listed here with the objectClass name (view them as auxiliary objectClass)
-- entry_id the "ldap_entries.id" of the entry this objectClass value must be added
-- oc_name the name of the objectClass; it MUST match the name of an objectClass that is loaded in slapd's schema
insert into ldap_entry_objclasses (entry_id,oc_name)
values (1,'dcObject');

insert into ldap_entry_objclasses (entry_id,oc_name)
values (4,'pkiUser');

insert into ldap_entry_objclasses (entry_id,oc_name)
values (7,'extensibleObject');</pre>
<p>&nbsp;</p>
<p>And now we have a working database lets connect it with odbc</p>
<p>&nbsp;</p>
<h3>2. Setup odbc to work with our db</h3>
<p>&nbsp;</p>
<pre>yum install unixODBC mysql-connector-odbc</pre>
<p>&nbsp;</p>
<p>Create the file</p>
<pre>vi /etc/odbc.ini</pre>
<p>And add the follow</p>
<p>&nbsp;</p>
<pre>[ldap]
Description = LdapToMysql
Driver = MySQL
Database = ldap
Server = 127.0.0.1
User = ldap
Password = ldap
Port = 3306</pre>
<p>&nbsp;</p>
<p>Test soo that it work</p>
<pre>isql -v ldap


SQL&gt; show databases;</pre>
<p>And you show now see you ldap database in there. And now we are eady to setup openldap to use our sql database.</p>
<p>&nbsp;</p>
<h3>3. Install and setup Openldap</h3>
<p>&nbsp;</p>
<pre>yum install wget make gcc mysql-devel unixODBC-devel groff -y

cd /opt
wget ftp://mirror.switch.ch/mirror/OpenLDAP/openldap-release/openldap-2.4.43.tgz
tar zxvf openldap-*.tgz
rm -rf openldap-*.tgz
mv openldap-* openldap
cd /opt/openldap
./configure --prefix=/usr --exec-prefix=/usr --bindir=/usr/bin --sbindir=/usr/sbin --sysconfdir=/etc --datadir=/usr/share --localstatedir=/var --mandir=/usr/share/man --infodir=/usr/share/info --enable-sql --disable-bdb --disable-ndb --disable-hdb
make depend
make
make install</pre>
<p>Create the file /etc/openldap/slapd.conf and add the following to it</p>
<p><strong>You can create you own password with slappasswd and copy it in here</strong></p>
<p>&nbsp;</p>
<pre># $OpenLDAP: pkg/ldap/servers/slapd/slapd.conf,v 1.23.2.8 2003/05/24 23:19:14 ku
#
# See slapd.conf(5) for details on configuration options.
# This file should NOT be world readable.
#
include /etc/openldap/schema/core.schema
include /etc/openldap/schema/cosine.schema
include /etc/openldap/schema/inetorgperson.schema
pidfile /var/run/slapd.pid
argsfile /var/run/slapd.args
#######################################################################
# sql database definitions
#######################################################################
database sql
suffix "dc=life,dc=com"
# Only need if not using the ldbm/bdb stuff below
rootdn "cn=manager,dc=life,dc=com"
rootpw {SSHA}bv2pkHnDTvS6cOCK/jbhsnX5UEgdrd7F
dbname ldap
dbuser ldap
dbpasswd ldap
has_ldapinfo_dn_ru no
subtree_cond "ldap_entries.dn LIKE CONCAT('%',?)"</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>And now we can start it with</p>
<pre>/opt/openldap/servers/slapd/slapd -d 5 -h 'ldap:/// ldapi:///' -f /etc/openldap/slapd.conf &amp;</pre>
<p>&nbsp;</p>
<p>And you can get you uses from it by running</p>
<pre>ldapsearch -x -b "dc=life,dc=com"</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>DockerFile</p>
<p>&nbsp;</p>
<p>I have also made a Dockerfile for this that you can use</p>
<p>&nbsp;</p>
<pre>from fareoffice/base

MAINTAINER Mattias Hemmingsson

RUN yum install wget make gcc mysql-devel unixODBC-devel groff -y
WORKDIR /opt/

#Setup openldap
RUN wget ftp://mirror.switch.ch/mirror/OpenLDAP/openldap-release/openldap-2.4.43.tgz
RUN tar zxvf openldap-*.tgz
RUN rm -rf openldap-*.tgz
RUN mv openldap-* openldap
WORKDIR /opt/openldap
RUN ./configure --prefix=/usr --exec-prefix=/usr --bindir=/usr/bin --sbindir=/usr/sbin --sysconfdir=/etc --datadir=/usr/share --localstatedir=/var --mandir=/usr/share/man --infodir=/usr/share/info --enable-sql --disable-bdb --disable-ndb --disable-hdb
RUN make depend
RUN make
RUN make install
ADD config/slapd.conf /etc/openldap/slapd.conf
#Setting up mysql connection
RUN yum install mysql-connector-odbc -y
RUN odbcinst -j
ADD config/odbc.ini /etc/odbc.ini

#Setting up local mysql
ADD config/init-sql.sql /opt/install/
RUN yum install mariadb-server -y
RUN mysql_install_db
RUN chown mysql:mysql -R /var/lib/mysql/
RUN mysqld_safe &amp; sleep 3 &amp;&amp; mysql &lt; /opt/install/init-sql.sql

CMD mysqld_safe &amp; sleep 3 &amp;&amp; /opt/openldap/servers/slapd/slapd -d 5 -h 'ldap:/// ldapi:///' -f /etc/openldap/slapd.conf &amp;</pre>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts/">Writings</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/git/">Git</a></li>
         
          <li><a href="/podcast/">Podcast</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f&text=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f&title=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f&is_video=false&description=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker&body=Check out this article: https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f&title=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f&title=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f&name=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker&description=We%20use%20Ldap%20for%20handling%20our%20users%20and%20I%20have%20spent%20time%20setting%20up%20Openldap%20and%20tryng%20to%20configur%20it.%0aBut%20now%20i%20have%20given%20up%20my%20ldap%20skills%20and%20setup%20my%20openldap%20to%20use%20a%20sql%20backend%20and%20then%20i%20config%20my%20user%20with%20SQL%20that%20i%20like%20more.%0aI%20have%20also%20build%20i%20Dockerfile%20for%20docker%20that%20you%20can%20use.%0a%26nbsp%3b%0a%26nbsp%3b%0aSo%20what%20you%20need%20is%20one%20sql%20databserver%20to%20hold%20that%20database%2c%20One%20odbc%20connection%20from%20the%20ldap%20server%20to%20that%20sql%20server." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2flifeandshell.com%2fposts%2fopenldap-with-sql-backend-mariadb%2f&t=Openldap%20with%20SQL%20Backend%20%28Mariadb%20Centos%207%20%29%20in%20Docker" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2026  Mattias Hemmingssion <a href="mailto:mattias@lifeandshell.com">mattias@lifeandshell.com</a> 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts/">Writings</a></li>
         
        <li><a href="/tags/">Tags</a></li>
         
        <li><a href="/git/">Git</a></li>
         
        <li><a href="/podcast/">Podcast</a></li>
         
        <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>

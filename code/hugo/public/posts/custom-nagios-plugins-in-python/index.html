<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Custom nagios plugins in python | Life and Shell</title>
  <link rel = 'canonical' href = 'https://lifeandshell.com/posts/custom-nagios-plugins-in-python/'>
  <meta name="description" content="  Mattias Hemmingsson: Welcome to my private site collecting blog post, Git updates and podcast episodes">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">



 <script async src="https://www.googletagmanager.com/gtag/js?id=G-3SYH00HY9X"></script>
 <script>
   window.dataLayer = window.dataLayer || [];
   function gtag(){dataLayer.push(arguments);}
   gtag('js', new Date());
   gtag('config', 'G-3SYH00HY9X');
 </script>


  <meta property="og:url" content="https://lifeandshell.com/posts/custom-nagios-plugins-in-python/">
  <meta property="og:site_name" content="Life and Shell">
  <meta property="og:title" content="Custom nagios plugins in python">
  <meta property="og:description" content="For monitoring different service and function you may need to build some custom monitoring plugins. I have some build for nrpe and will work with both nagios and icinga.
This script will do and mysql check and then send the data back and also start graphing the data back if you use pnp4nagios ðŸ™‚
Every plugin must have two things.
1. an exit code thet will say the state of the plugin (OK.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2013-11-05T15:20:51+00:00">
    <meta property="article:modified_time" content="2013-11-05T15:20:51+00:00">
    <meta property="article:tag" content="Code">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Web">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Custom nagios plugins in python">
  <meta name="twitter:description" content="For monitoring different service and function you may need to build some custom monitoring plugins. I have some build for nrpe and will work with both nagios and icinga.
This script will do and mysql check and then send the data back and also start graphing the data back if you use pnp4nagios ðŸ™‚
Every plugin must have two things.
1. an exit code thet will say the state of the plugin (OK.">

  
  
    
  
  
  <link rel="stylesheet" href="https://lifeandshell.com/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css" integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N&#43;XoIuZg=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://lifeandshell.com/images/favicon.ico" />

  
  
  

</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts/">Writings</a></li>
         
        <li><a href="/tags/">Tags</a></li>
         
        <li><a href="/git/">Git</a></li>
         
        <li><a href="/podcast/">Podcast</a></li>
         
        <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://lifeandshell.com/posts/rolling-back-andrioid-on-your-nexus-4-after-ubuntu/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://lifeandshell.com/posts/install-diaspora-one-centos-6-4-with-apache/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f&text=Custom%20nagios%20plugins%20in%20python" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f&title=Custom%20nagios%20plugins%20in%20python" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f&is_video=false&description=Custom%20nagios%20plugins%20in%20python" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Custom%20nagios%20plugins%20in%20python&body=Check out this article: https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f&title=Custom%20nagios%20plugins%20in%20python" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f&title=Custom%20nagios%20plugins%20in%20python" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f&name=Custom%20nagios%20plugins%20in%20python&description=For%20monitoring%20different%20service%20and%20function%20you%20may%20need%20to%20build%20some%20custom%20monitoring%20plugins.%20I%20have%20some%20build%20for%20nrpe%20and%20will%20work%20with%20both%20nagios%20and%20icinga.%0aThis%20script%20will%20do%20and%20mysql%20check%20and%20then%20send%20the%20data%20back%20and%20also%20start%20graphing%20the%20data%20back%20if%20you%20use%20pnp4nagios%20%f0%9f%99%82%0aEvery%20plugin%20must%20have%20two%20things.%0a1.%20an%20exit%20code%20thet%20will%20say%20the%20state%20of%20the%20plugin%20%28OK." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f&t=Custom%20nagios%20plugins%20in%20python" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Custom nagios plugins in python
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2013-11-05 15:20:51 &#43;0000 UTC" itemprop="datePublished">2013-11-05</time>
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          1 minute read
        </div>
        
        
        <div class="article-category">
            <i class="fas fa-archive"></i>
            
            
            <a class="category-link" href="/categories/code">Code</a>
            
             ,  
            <a class="category-link" href="/categories/linux">Linux</a>
            
             ,  
            <a class="category-link" href="/categories/web">Web</a>
            
        </div>
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/code" rel="tag">Code</a>
            
             ,  
            <a class="tag-link" href="/tags/linux" rel="tag">Linux</a>
            
             ,  
            <a class="tag-link" href="/tags/web" rel="tag">Web</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <p>For monitoring different service and function you may need to build some custom monitoring plugins. I have some build for nrpe and will work with both nagios and icinga.<br />
This script will do and <strong>mysql</strong> check and then send the data back and also start graphing the data back if you use <strong>pnp4nagios</strong> ðŸ™‚</p>
<p>Every plugin must have <strong>two</strong> things.</p>
<h3>1. an exit code thet will say the state of the plugin (OK.Critical,warning) &lt;- this will generate the alerts</h3>
<ul>
<li>1 = ok</li>
<li>2= Critical</li>
<li>3=Warnings</li>
<li>4= unknown</li>
</ul>
<p>&nbsp;</p>
<h3>2. Some text to abaout the plugin saying for exampel disk space.</h3>
<p>&nbsp;</p>
<p>Here below is my small script that will de some db qestions ans return the result to nagios. If the values return is under 0 then it will exit in state 2 and then nagios will alert.</p>
<p>&nbsp;</p>
<pre>#!/usr/bin/env python
#Mysql stats
#Get stats from mysql server
#then prints the stats to icinga to process</pre>
<pre>import MySQLdb
from datetime import date, timedelta
import datetime
import sys</pre>
<pre>'''
MYSQL
'''
mysqlhost="localhost"
mysqluser="monitor"
mysqlpass="XXXXXXX"
mysqldb="db"</pre>
<pre>
def mysql_query(sql):
 '''
 run an mysql mysql_query
 '''
 try:
 con = None
 con = MySQLdb.Connection(mysqlhost, mysqluser,
 mysqlpass, mysqldb)
 curs = con.cursor()
 curs.execute(sql)
 con.commit()
 back=[]
 for value in curs:
 back.append(value[0])
 return back</pre>
<pre>
 except MySQLdb.Error, e:
 print "Error in MYSQL {0} : {1}".format(e.args[0], e.args[1])
 sys.exit(1)
 finally:
 if con:
 con.close()</pre>
<pre></pre>
<pre>
#mysql to run on the mysql server
qery="""SELEC your own super mysql qery and the group by"""

#Send mysql to server
back =mysql_query(qery)

#Testing result and building string back to nagios
if back[0] &lt;= 30:
 print "CRITICAL | 'value'="+str(back[0])+" 'value'="+str(back[1])
 sys.exit(2)
else:
 print "OK: | 'value'="+str(back[0])+" 'value'="+str(back[1])
 sys.exit(0)</pre>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts/">Writings</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/git/">Git</a></li>
         
          <li><a href="/podcast/">Podcast</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f&text=Custom%20nagios%20plugins%20in%20python" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f&title=Custom%20nagios%20plugins%20in%20python" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f&is_video=false&description=Custom%20nagios%20plugins%20in%20python" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Custom%20nagios%20plugins%20in%20python&body=Check out this article: https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f&title=Custom%20nagios%20plugins%20in%20python" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f&title=Custom%20nagios%20plugins%20in%20python" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f&name=Custom%20nagios%20plugins%20in%20python&description=For%20monitoring%20different%20service%20and%20function%20you%20may%20need%20to%20build%20some%20custom%20monitoring%20plugins.%20I%20have%20some%20build%20for%20nrpe%20and%20will%20work%20with%20both%20nagios%20and%20icinga.%0aThis%20script%20will%20do%20and%20mysql%20check%20and%20then%20send%20the%20data%20back%20and%20also%20start%20graphing%20the%20data%20back%20if%20you%20use%20pnp4nagios%20%f0%9f%99%82%0aEvery%20plugin%20must%20have%20two%20things.%0a1.%20an%20exit%20code%20thet%20will%20say%20the%20state%20of%20the%20plugin%20%28OK." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2flifeandshell.com%2fposts%2fcustom-nagios-plugins-in-python%2f&t=Custom%20nagios%20plugins%20in%20python" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2026  Mattias Hemmingssion <a href="mailto:mattias@lifeandshell.com">mattias@lifeandshell.com</a> 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts/">Writings</a></li>
         
        <li><a href="/tags/">Tags</a></li>
         
        <li><a href="/git/">Git</a></li>
         
        <li><a href="/podcast/">Podcast</a></li>
         
        <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>

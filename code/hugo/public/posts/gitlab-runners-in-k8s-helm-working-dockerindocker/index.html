<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Gitlab runners in K8s Helm (Working DockerInDocker) | Life and Shell</title>
  <link rel = 'canonical' href = 'https://lifeandshell.com/posts/gitlab-runners-in-k8s-helm-working-dockerindocker/'>
  <meta name="description" content="  Mattias Hemmingsson: Welcome to my private site collecting blog post, Git updates and podcast episodes">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">



 <script async src="https://www.googletagmanager.com/gtag/js?id=G-3SYH00HY9X"></script>
 <script>
   window.dataLayer = window.dataLayer || [];
   function gtag(){dataLayer.push(arguments);}
   gtag('js', new Date());
   gtag('config', 'G-3SYH00HY9X');
 </script>


  <meta property="og:url" content="https://lifeandshell.com/posts/gitlab-runners-in-k8s-helm-working-dockerindocker/">
  <meta property="og:site_name" content="Life and Shell">
  <meta property="og:title" content="Gitlab runners in K8s Helm (Working DockerInDocker)">
  <meta property="og:description" content="So… I spent alot of time trying to get gitlab runners working in kubernetes. using the helm from gitlab.
This is the setup i use now that works for me aand that you dont need to put to mutch inte the build job.
Replace so you have your domain and key
name the file runners1-values.yaml
## The GitLab Server URL (with protocol) that want to register the runner against">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-12-11T13:24:35+00:00">
    <meta property="article:modified_time" content="2020-12-11T13:24:35+00:00">
    <meta property="article:tag" content="Linux">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Gitlab runners in K8s Helm (Working DockerInDocker)">
  <meta name="twitter:description" content="So… I spent alot of time trying to get gitlab runners working in kubernetes. using the helm from gitlab.
This is the setup i use now that works for me aand that you dont need to put to mutch inte the build job.
Replace so you have your domain and key
name the file runners1-values.yaml
## The GitLab Server URL (with protocol) that want to register the runner against">

  
  
    
  
  
  <link rel="stylesheet" href="https://lifeandshell.com/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css" integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N&#43;XoIuZg=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://lifeandshell.com/images/favicon.ico" />

  
  
  

</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts/">Writings</a></li>
         
        <li><a href="/tags/">Tags</a></li>
         
        <li><a href="/git/">Git</a></li>
         
        <li><a href="/podcast/">Podcast</a></li>
         
        <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://lifeandshell.com/posts/vault-eks-aws-to-pod-the-complete-guide/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://lifeandshell.com/posts/k8s-logs-to-elastic-with-dynamic-ilm-from-annotations/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f&text=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f&title=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f&is_video=false&description=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29&body=Check out this article: https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f&title=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f&title=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f&name=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29&description=So%26%238230%3b%20I%20spent%20alot%20of%20time%20trying%20to%20get%20gitlab%20runners%20working%20in%20kubernetes.%20using%20the%20helm%20from%20gitlab.%0aThis%20is%20the%20setup%20i%20use%20now%20that%20works%20for%20me%20aand%20that%20you%20dont%20need%20to%20put%20to%20mutch%20inte%20the%20build%20job.%0aReplace%20so%20you%20have%20your%20domain%20and%20key%0aname%20the%20file%20runners1-values.yaml%0a%23%23%20The%20GitLab%20Server%20URL%20%28with%20protocol%29%20that%20want%20to%20register%20the%20runner%20against" aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f&t=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Gitlab runners in K8s Helm (Working DockerInDocker)
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2020-12-11 13:24:35 &#43;0000 UTC" itemprop="datePublished">2020-12-11</time>
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          2 minute read
        </div>
        
        
        <div class="article-category">
            <i class="fas fa-archive"></i>
            
            
            <a class="category-link" href="/categories/linux">Linux</a>
            
        </div>
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/linux" rel="tag">Linux</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      
<p id="block-813bada9-6b23-4850-b652-97b1be6d04bd">So&#8230; I spent alot of time trying to get gitlab runners working in kubernetes. using the helm from gitlab.<br>This is the setup i use now that works for me aand that you dont need to put to mutch inte the build job.<br><br>Replace so you have your domain and key</p>



<p id="block-0f41831b-8681-4547-8d7a-0ab8885a9259">name the file runners1-values.yaml</p>



<pre id="block-9711e90c-47e7-4e46-9241-9e56107a54dc" class="wp-block-code"><code>## The GitLab Server URL (with protocol) that want to register the runner against<br>## ref: https://docs.gitlab.com/runner/commands/README.html#gitlab-runner-register<br>##<br>gitlabUrl: https://    .booli.se/<br>name: "K8s INT"<br>## The registration token for adding new Runners to the GitLab server. This must<br>## be retrieved from your GitLab instance.<br>## ref: https://docs.gitlab.com/ee/ci/runners/<br>##<br>runnerRegistrationToken: ""<br><br>## Set the certsSecretName in order to pass custom certificates for GitLab Runner to use<br>## Provide resource name for a Kubernetes Secret Object in the same namespace,<br>## this is used to populate the /etc/gitlab-runner/certs directory<br>## ref: https://docs.gitlab.com/runner/configuration/tls-self-signed.html#supported-options-for-self-signed-certificates<br>##<br>#certsSecretName:<br><br>## Configure the maximum number of concurrent jobs<br>## ref: https://docs.gitlab.com/runner/configuration/advanced-configuration.html#the-global-section<br>##<br>concurrent: 10<br><br>## Defines in seconds how often to check GitLab for a new builds<br>## ref: https://docs.gitlab.com/runner/configuration/advanced-configuration.html#the-global-section<br>##<br>checkInterval: 2<br><br>## For RBAC support:<br>rbac:<br><br>  ## Run the gitlab-bastion container with the ability to deploy/manage containers of jobs<br>  ## cluster-wide or only within namespace<br>  clusterWideAccess: false<br><br>  ## If RBAC is disabled in this Helm chart, use the following Kubernetes Service Account name.<br>  ##<br>  serviceAccountName: gitlab-runner-admin<br><br>## Configuration for the Pods that the runner launches for each new job<br>##<br>metrics:<br>  enabled: true<br><br>runners:<br>  ## Default container image to use for builds when none is specified<br>  ##<br>  image: docker:19.03.13<br>  config: |<br>    &#91;&#91;runners]]<br>      environment = &#91;"DOCKER_HOST=tcp://docker:2376", "DOCKER_TLS_CERTDIR=/certs", "DOCKER_TLS_VERIFY=1", "DOCKER_CERT_PATH=/certs/client"]<br>      &#91;runners.kubernetes]<br>        image = "docker:19.03.13"<br>        privileged = true<br>        cpu_request = "100m"<br>        memory_request = "128Mi"<br>        helper_cpu_request = "200m"<br>        &#91;runners.kubernetes.node_selector]<br>           gitlab = "true"<br>        &#91;&#91;runners.kubernetes.volumes.empty_dir]]<br>          name = "docker-certs"<br>          mount_path = "/certs/client"<br>          medium = "Memory"<br><br><br><br><br><br>  ## Run all containers with the privileged flag enabled<br>  ## This will allow the docker:stable-dind image to run if you need to run Docker<br>  ## commands. Please read the docs before turning this on:<br>  ## ref: https://docs.gitlab.com/runner/executors/kubernetes.html#using-docker-dind<br>  ##<br>  tags: "int,k8s,dind"<br>  ## Namespace to run Kubernetes jobs in (defaults to 'default')<br>  ##<br>  namespace: gitlab<br>  nodeSelector:<br>    gitlab: true<br>  ## Build Container specific configuration<br>  ##<br>  kubernetes:<br>    node_selector:<br>      gitlab = "true"<br>  builds:<br>    cpuLimit: 2000m<br>    memoryLimit: 2048Mi<br>    cpuRequests: 100m<br>    memoryRequests: 128Mi<br>    node_selector: gitlab=true<br>  ## Service Container specific configuration<br>  ##<br>  services:<br>    # cpuLimit: 200m<br>    # memoryLimit: 256Mi<br>    cpuRequests: 100m<br>    memoryRequests: 128Mi<br><br>  ## Helper Container specific configuration<br>  ##<br>  helpers:<br>    # cpuLimit: 200m<br>    # memoryLimit: 256Mi<br>    cpuRequests: 100m<br>    memoryRequests: 128Mi<br>    node_selector: gitlab=true<br>﻿</code></pre>



<p id="block-bd3ddfe3-4833-4a5f-98bb-b5eb3a2100ae">Apply it with</p>



<pre id="block-12b4354f-02f6-4626-8f5d-258e4c5ccf58" class="wp-block-code"><code>#!/bin/bash<br>helm repo add gitlab https://charts.gitlab.io<br>helm repo update<br><br>kubectl create namespace gitlab<br>kubectl apply -f gitlab-service-account.yaml <br><br>helm upgrade --install --namespace gitlab gitlab-runner -f runners1-values.yaml gitlab/gitlab-runner<br>﻿</code></pre>



<p id="block-6e4ec73e-1a52-497d-a938-23d3169c621d">And now you have it wokring fine in the cluster</p>



<p></p>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts/">Writings</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/git/">Git</a></li>
         
          <li><a href="/podcast/">Podcast</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f&text=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f&title=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f&is_video=false&description=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29&body=Check out this article: https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f&title=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f&title=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f&name=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29&description=So%26%238230%3b%20I%20spent%20alot%20of%20time%20trying%20to%20get%20gitlab%20runners%20working%20in%20kubernetes.%20using%20the%20helm%20from%20gitlab.%0aThis%20is%20the%20setup%20i%20use%20now%20that%20works%20for%20me%20aand%20that%20you%20dont%20need%20to%20put%20to%20mutch%20inte%20the%20build%20job.%0aReplace%20so%20you%20have%20your%20domain%20and%20key%0aname%20the%20file%20runners1-values.yaml%0a%23%23%20The%20GitLab%20Server%20URL%20%28with%20protocol%29%20that%20want%20to%20register%20the%20runner%20against" aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2flifeandshell.com%2fposts%2fgitlab-runners-in-k8s-helm-working-dockerindocker%2f&t=Gitlab%20runners%20in%20K8s%20Helm%20%28Working%20DockerInDocker%29" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2026  Mattias Hemmingssion <a href="mailto:mattias@lifeandshell.com">mattias@lifeandshell.com</a> 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts/">Writings</a></li>
         
        <li><a href="/tags/">Tags</a></li>
         
        <li><a href="/git/">Git</a></li>
         
        <li><a href="/podcast/">Podcast</a></li>
         
        <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>
